// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: shipping.sql

package db

import (
	"context"
	"encoding/json"
	"time"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createShippingZone = `-- name: CreateShippingZone :one
INSERT INTO shipping_zones (
  id, name, countries, calculation_method, rates, position,
  created_at, updated_at
) VALUES ($1, $2, $3, $4, $5, $6, $7, $7)
RETURNING id, name, countries, calculation_method, rates, position, created_at, updated_at
`

type CreateShippingZoneParams struct {
	ID                uuid.UUID       `json:"id"`
	Name              string          `json:"name"`
	Countries         []string        `json:"countries"`
	CalculationMethod string          `json:"calculation_method"`
	Rates             json.RawMessage `json:"rates"`
	Position          int32           `json:"position"`
	CreatedAt         time.Time       `json:"created_at"`
}

func (q *Queries) CreateShippingZone(ctx context.Context, arg CreateShippingZoneParams) (ShippingZone, error) {
	row := q.db.QueryRow(ctx, createShippingZone,
		arg.ID,
		arg.Name,
		arg.Countries,
		arg.CalculationMethod,
		arg.Rates,
		arg.Position,
		arg.CreatedAt,
	)
	var i ShippingZone
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Countries,
		&i.CalculationMethod,
		&i.Rates,
		&i.Position,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteShippingZone = `-- name: DeleteShippingZone :exec
DELETE FROM shipping_zones WHERE id = $1
`

func (q *Queries) DeleteShippingZone(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteShippingZone, id)
	return err
}

const getShippingConfig = `-- name: GetShippingConfig :one
SELECT id, enabled, calculation_method, fixed_fee, weight_rates, size_rates, free_shipping_threshold, default_currency, created_at, updated_at FROM shipping_config LIMIT 1
`

func (q *Queries) GetShippingConfig(ctx context.Context) (ShippingConfig, error) {
	row := q.db.QueryRow(ctx, getShippingConfig)
	var i ShippingConfig
	err := row.Scan(
		&i.ID,
		&i.Enabled,
		&i.CalculationMethod,
		&i.FixedFee,
		&i.WeightRates,
		&i.SizeRates,
		&i.FreeShippingThreshold,
		&i.DefaultCurrency,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getShippingZone = `-- name: GetShippingZone :one
SELECT id, name, countries, calculation_method, rates, position, created_at, updated_at FROM shipping_zones WHERE id = $1
`

func (q *Queries) GetShippingZone(ctx context.Context, id uuid.UUID) (ShippingZone, error) {
	row := q.db.QueryRow(ctx, getShippingZone, id)
	var i ShippingZone
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Countries,
		&i.CalculationMethod,
		&i.Rates,
		&i.Position,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getShippingZoneForCountry = `-- name: GetShippingZoneForCountry :one
SELECT sz.id, sz.name, sz.countries, sz.calculation_method, sz.rates, sz.position, sz.created_at, sz.updated_at FROM shipping_zones sz
JOIN store_shipping_countries ssc ON ssc.shipping_zone_id = sz.id
WHERE ssc.country_code = $1 AND ssc.is_enabled = true
`

func (q *Queries) GetShippingZoneForCountry(ctx context.Context, countryCode string) (ShippingZone, error) {
	row := q.db.QueryRow(ctx, getShippingZoneForCountry, countryCode)
	var i ShippingZone
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Countries,
		&i.CalculationMethod,
		&i.Rates,
		&i.Position,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listEnabledShippingCountriesWithZones = `-- name: ListEnabledShippingCountriesWithZones :many
SELECT
  ssc.country_code,
  ssc.is_enabled,
  ssc.shipping_zone_id,
  ssc.position,
  ec.name AS country_name,
  ec.currency AS country_currency,
  sz.name AS zone_name
FROM store_shipping_countries ssc
JOIN eu_countries ec ON ec.country_code = ssc.country_code
LEFT JOIN shipping_zones sz ON sz.id = ssc.shipping_zone_id
WHERE ssc.is_enabled = true
ORDER BY ssc.position, ec.name
`

type ListEnabledShippingCountriesWithZonesRow struct {
	CountryCode     string      `json:"country_code"`
	IsEnabled       bool        `json:"is_enabled"`
	ShippingZoneID  pgtype.UUID `json:"shipping_zone_id"`
	Position        int32       `json:"position"`
	CountryName     string      `json:"country_name"`
	CountryCurrency string      `json:"country_currency"`
	ZoneName        *string     `json:"zone_name"`
}

func (q *Queries) ListEnabledShippingCountriesWithZones(ctx context.Context) ([]ListEnabledShippingCountriesWithZonesRow, error) {
	rows, err := q.db.Query(ctx, listEnabledShippingCountriesWithZones)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListEnabledShippingCountriesWithZonesRow{}
	for rows.Next() {
		var i ListEnabledShippingCountriesWithZonesRow
		if err := rows.Scan(
			&i.CountryCode,
			&i.IsEnabled,
			&i.ShippingZoneID,
			&i.Position,
			&i.CountryName,
			&i.CountryCurrency,
			&i.ZoneName,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listShippingZones = `-- name: ListShippingZones :many
SELECT id, name, countries, calculation_method, rates, position, created_at, updated_at FROM shipping_zones ORDER BY position
`

func (q *Queries) ListShippingZones(ctx context.Context) ([]ShippingZone, error) {
	rows, err := q.db.Query(ctx, listShippingZones)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ShippingZone{}
	for rows.Next() {
		var i ShippingZone
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Countries,
			&i.CalculationMethod,
			&i.Rates,
			&i.Position,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateShippingConfig = `-- name: UpdateShippingConfig :one
UPDATE shipping_config SET
  enabled = $1,
  calculation_method = $2,
  fixed_fee = $3,
  weight_rates = $4,
  size_rates = $5,
  free_shipping_threshold = $6,
  updated_at = $7
WHERE id = (SELECT id FROM shipping_config LIMIT 1)
RETURNING id, enabled, calculation_method, fixed_fee, weight_rates, size_rates, free_shipping_threshold, default_currency, created_at, updated_at
`

type UpdateShippingConfigParams struct {
	Enabled               bool            `json:"enabled"`
	CalculationMethod     string          `json:"calculation_method"`
	FixedFee              pgtype.Numeric  `json:"fixed_fee"`
	WeightRates           json.RawMessage `json:"weight_rates"`
	SizeRates             json.RawMessage `json:"size_rates"`
	FreeShippingThreshold pgtype.Numeric  `json:"free_shipping_threshold"`
	UpdatedAt             time.Time       `json:"updated_at"`
}

func (q *Queries) UpdateShippingConfig(ctx context.Context, arg UpdateShippingConfigParams) (ShippingConfig, error) {
	row := q.db.QueryRow(ctx, updateShippingConfig,
		arg.Enabled,
		arg.CalculationMethod,
		arg.FixedFee,
		arg.WeightRates,
		arg.SizeRates,
		arg.FreeShippingThreshold,
		arg.UpdatedAt,
	)
	var i ShippingConfig
	err := row.Scan(
		&i.ID,
		&i.Enabled,
		&i.CalculationMethod,
		&i.FixedFee,
		&i.WeightRates,
		&i.SizeRates,
		&i.FreeShippingThreshold,
		&i.DefaultCurrency,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateShippingZone = `-- name: UpdateShippingZone :one
UPDATE shipping_zones SET
  name = $2,
  countries = $3,
  calculation_method = $4,
  rates = $5,
  position = $6,
  updated_at = $7
WHERE id = $1
RETURNING id, name, countries, calculation_method, rates, position, created_at, updated_at
`

type UpdateShippingZoneParams struct {
	ID                uuid.UUID       `json:"id"`
	Name              string          `json:"name"`
	Countries         []string        `json:"countries"`
	CalculationMethod string          `json:"calculation_method"`
	Rates             json.RawMessage `json:"rates"`
	Position          int32           `json:"position"`
	UpdatedAt         time.Time       `json:"updated_at"`
}

func (q *Queries) UpdateShippingZone(ctx context.Context, arg UpdateShippingZoneParams) (ShippingZone, error) {
	row := q.db.QueryRow(ctx, updateShippingZone,
		arg.ID,
		arg.Name,
		arg.Countries,
		arg.CalculationMethod,
		arg.Rates,
		arg.Position,
		arg.UpdatedAt,
	)
	var i ShippingZone
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Countries,
		&i.CalculationMethod,
		&i.Rates,
		&i.Position,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
