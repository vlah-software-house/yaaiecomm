// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: images.sql

package db

import (
	"context"
	"encoding/json"
	"time"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const countProductImagesByProduct = `-- name: CountProductImagesByProduct :one
SELECT COUNT(*) FROM product_images WHERE product_id = $1
`

func (q *Queries) CountProductImagesByProduct(ctx context.Context, productID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countProductImagesByProduct, productID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createMediaAsset = `-- name: CreateMediaAsset :one

INSERT INTO media_assets (
    id, filename, original_filename, content_type, size_bytes, url, width, height, metadata, created_at
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9, $10
)
RETURNING id, filename, original_filename, content_type, size_bytes, url, width, height, metadata, created_at
`

type CreateMediaAssetParams struct {
	ID               uuid.UUID       `json:"id"`
	Filename         string          `json:"filename"`
	OriginalFilename string          `json:"original_filename"`
	ContentType      string          `json:"content_type"`
	SizeBytes        int64           `json:"size_bytes"`
	Url              string          `json:"url"`
	Width            *int32          `json:"width"`
	Height           *int32          `json:"height"`
	Metadata         json.RawMessage `json:"metadata"`
	CreatedAt        time.Time       `json:"created_at"`
}

// images.sql â€” queries for product images and media assets
func (q *Queries) CreateMediaAsset(ctx context.Context, arg CreateMediaAssetParams) (MediaAsset, error) {
	row := q.db.QueryRow(ctx, createMediaAsset,
		arg.ID,
		arg.Filename,
		arg.OriginalFilename,
		arg.ContentType,
		arg.SizeBytes,
		arg.Url,
		arg.Width,
		arg.Height,
		arg.Metadata,
		arg.CreatedAt,
	)
	var i MediaAsset
	err := row.Scan(
		&i.ID,
		&i.Filename,
		&i.OriginalFilename,
		&i.ContentType,
		&i.SizeBytes,
		&i.Url,
		&i.Width,
		&i.Height,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const createProductImage = `-- name: CreateProductImage :one
INSERT INTO product_images (
    id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, $8, $9
)
RETURNING id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at
`

type CreateProductImageParams struct {
	ID        uuid.UUID   `json:"id"`
	ProductID uuid.UUID   `json:"product_id"`
	VariantID pgtype.UUID `json:"variant_id"`
	OptionID  pgtype.UUID `json:"option_id"`
	Url       string      `json:"url"`
	AltText   *string     `json:"alt_text"`
	Position  int32       `json:"position"`
	IsPrimary bool        `json:"is_primary"`
	CreatedAt time.Time   `json:"created_at"`
}

func (q *Queries) CreateProductImage(ctx context.Context, arg CreateProductImageParams) (ProductImage, error) {
	row := q.db.QueryRow(ctx, createProductImage,
		arg.ID,
		arg.ProductID,
		arg.VariantID,
		arg.OptionID,
		arg.Url,
		arg.AltText,
		arg.Position,
		arg.IsPrimary,
		arg.CreatedAt,
	)
	var i ProductImage
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.VariantID,
		&i.OptionID,
		&i.Url,
		&i.AltText,
		&i.Position,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const deleteMediaAsset = `-- name: DeleteMediaAsset :exec
DELETE FROM media_assets WHERE id = $1
`

func (q *Queries) DeleteMediaAsset(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteMediaAsset, id)
	return err
}

const deleteProductImage = `-- name: DeleteProductImage :exec
DELETE FROM product_images WHERE id = $1
`

func (q *Queries) DeleteProductImage(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteProductImage, id)
	return err
}

const getMediaAsset = `-- name: GetMediaAsset :one
SELECT id, filename, original_filename, content_type, size_bytes, url, width, height, metadata, created_at FROM media_assets WHERE id = $1
`

func (q *Queries) GetMediaAsset(ctx context.Context, id uuid.UUID) (MediaAsset, error) {
	row := q.db.QueryRow(ctx, getMediaAsset, id)
	var i MediaAsset
	err := row.Scan(
		&i.ID,
		&i.Filename,
		&i.OriginalFilename,
		&i.ContentType,
		&i.SizeBytes,
		&i.Url,
		&i.Width,
		&i.Height,
		&i.Metadata,
		&i.CreatedAt,
	)
	return i, err
}

const getPrimaryImageByProduct = `-- name: GetPrimaryImageByProduct :one
SELECT id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at FROM product_images
WHERE product_id = $1 AND is_primary = true
LIMIT 1
`

func (q *Queries) GetPrimaryImageByProduct(ctx context.Context, productID uuid.UUID) (ProductImage, error) {
	row := q.db.QueryRow(ctx, getPrimaryImageByProduct, productID)
	var i ProductImage
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.VariantID,
		&i.OptionID,
		&i.Url,
		&i.AltText,
		&i.Position,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const getProductImage = `-- name: GetProductImage :one
SELECT id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at FROM product_images WHERE id = $1
`

func (q *Queries) GetProductImage(ctx context.Context, id uuid.UUID) (ProductImage, error) {
	row := q.db.QueryRow(ctx, getProductImage, id)
	var i ProductImage
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.VariantID,
		&i.OptionID,
		&i.Url,
		&i.AltText,
		&i.Position,
		&i.IsPrimary,
		&i.CreatedAt,
	)
	return i, err
}

const listProductImagesByProduct = `-- name: ListProductImagesByProduct :many
SELECT id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at FROM product_images
WHERE product_id = $1
ORDER BY position ASC, created_at ASC
`

func (q *Queries) ListProductImagesByProduct(ctx context.Context, productID uuid.UUID) ([]ProductImage, error) {
	rows, err := q.db.Query(ctx, listProductImagesByProduct, productID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ProductImage{}
	for rows.Next() {
		var i ProductImage
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.VariantID,
			&i.OptionID,
			&i.Url,
			&i.AltText,
			&i.Position,
			&i.IsPrimary,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listProductImagesByVariant = `-- name: ListProductImagesByVariant :many
SELECT id, product_id, variant_id, option_id, url, alt_text, position, is_primary, created_at FROM product_images
WHERE variant_id = $1
ORDER BY position ASC, created_at ASC
`

func (q *Queries) ListProductImagesByVariant(ctx context.Context, variantID pgtype.UUID) ([]ProductImage, error) {
	rows, err := q.db.Query(ctx, listProductImagesByVariant, variantID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ProductImage{}
	for rows.Next() {
		var i ProductImage
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.VariantID,
			&i.OptionID,
			&i.Url,
			&i.AltText,
			&i.Position,
			&i.IsPrimary,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const setPrimaryProductImage = `-- name: SetPrimaryProductImage :exec
UPDATE product_images
SET is_primary = true
WHERE id = $1
`

func (q *Queries) SetPrimaryProductImage(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, setPrimaryProductImage, id)
	return err
}

const unsetPrimaryProductImages = `-- name: UnsetPrimaryProductImages :exec
UPDATE product_images
SET is_primary = false
WHERE product_id = $1 AND is_primary = true
`

func (q *Queries) UnsetPrimaryProductImages(ctx context.Context, productID uuid.UUID) error {
	_, err := q.db.Exec(ctx, unsetPrimaryProductImages, productID)
	return err
}

const updateProductImage = `-- name: UpdateProductImage :exec
UPDATE product_images
SET alt_text = $1,
    position = $2,
    is_primary = $3
WHERE id = $4
`

type UpdateProductImageParams struct {
	AltText   *string   `json:"alt_text"`
	Position  int32     `json:"position"`
	IsPrimary bool      `json:"is_primary"`
	ID        uuid.UUID `json:"id"`
}

func (q *Queries) UpdateProductImage(ctx context.Context, arg UpdateProductImageParams) error {
	_, err := q.db.Exec(ctx, updateProductImage,
		arg.AltText,
		arg.Position,
		arg.IsPrimary,
		arg.ID,
	)
	return err
}

const updateProductImagePosition = `-- name: UpdateProductImagePosition :exec
UPDATE product_images
SET position = $1
WHERE id = $2
`

type UpdateProductImagePositionParams struct {
	Position int32     `json:"position"`
	ID       uuid.UUID `json:"id"`
}

func (q *Queries) UpdateProductImagePosition(ctx context.Context, arg UpdateProductImagePositionParams) error {
	_, err := q.db.Exec(ctx, updateProductImagePosition, arg.Position, arg.ID)
	return err
}

const updateProductImageVariant = `-- name: UpdateProductImageVariant :exec
UPDATE product_images
SET variant_id = $1,
    option_id = $2
WHERE id = $3
`

type UpdateProductImageVariantParams struct {
	VariantID pgtype.UUID `json:"variant_id"`
	OptionID  pgtype.UUID `json:"option_id"`
	ID        uuid.UUID   `json:"id"`
}

func (q *Queries) UpdateProductImageVariant(ctx context.Context, arg UpdateProductImageVariantParams) error {
	_, err := q.db.Exec(ctx, updateProductImageVariant, arg.VariantID, arg.OptionID, arg.ID)
	return err
}
