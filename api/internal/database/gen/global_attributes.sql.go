// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: global_attributes.sql

package db

import (
	"context"
	"encoding/json"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const countGlobalAttributeUsage = `-- name: CountGlobalAttributeUsage :one
SELECT COUNT(*) FROM product_global_attribute_links WHERE global_attribute_id = $1
`

func (q *Queries) CountGlobalAttributeUsage(ctx context.Context, globalAttributeID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, countGlobalAttributeUsage, globalAttributeID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createGlobalAttribute = `-- name: CreateGlobalAttribute :one
INSERT INTO global_attributes (id, name, display_name, description, attribute_type, category, position, is_active)
VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
RETURNING id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at
`

type CreateGlobalAttributeParams struct {
	ID            uuid.UUID `json:"id"`
	Name          string    `json:"name"`
	DisplayName   string    `json:"display_name"`
	Description   *string   `json:"description"`
	AttributeType string    `json:"attribute_type"`
	Category      *string   `json:"category"`
	Position      int32     `json:"position"`
	IsActive      bool      `json:"is_active"`
}

func (q *Queries) CreateGlobalAttribute(ctx context.Context, arg CreateGlobalAttributeParams) (GlobalAttribute, error) {
	row := q.db.QueryRow(ctx, createGlobalAttribute,
		arg.ID,
		arg.Name,
		arg.DisplayName,
		arg.Description,
		arg.AttributeType,
		arg.Category,
		arg.Position,
		arg.IsActive,
	)
	var i GlobalAttribute
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DisplayName,
		&i.Description,
		&i.AttributeType,
		&i.Category,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createGlobalAttributeOption = `-- name: CreateGlobalAttributeOption :one
INSERT INTO global_attribute_options (
  id, global_attribute_id, value, display_value, color_hex,
  image_url, metadata, position, is_active
) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
RETURNING id, global_attribute_id, value, display_value, color_hex, image_url, metadata, position, is_active, created_at, updated_at
`

type CreateGlobalAttributeOptionParams struct {
	ID                uuid.UUID       `json:"id"`
	GlobalAttributeID uuid.UUID       `json:"global_attribute_id"`
	Value             string          `json:"value"`
	DisplayValue      string          `json:"display_value"`
	ColorHex          *string         `json:"color_hex"`
	ImageUrl          *string         `json:"image_url"`
	Metadata          json.RawMessage `json:"metadata"`
	Position          int32           `json:"position"`
	IsActive          bool            `json:"is_active"`
}

func (q *Queries) CreateGlobalAttributeOption(ctx context.Context, arg CreateGlobalAttributeOptionParams) (GlobalAttributeOption, error) {
	row := q.db.QueryRow(ctx, createGlobalAttributeOption,
		arg.ID,
		arg.GlobalAttributeID,
		arg.Value,
		arg.DisplayValue,
		arg.ColorHex,
		arg.ImageUrl,
		arg.Metadata,
		arg.Position,
		arg.IsActive,
	)
	var i GlobalAttributeOption
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.Value,
		&i.DisplayValue,
		&i.ColorHex,
		&i.ImageUrl,
		&i.Metadata,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createMetadataField = `-- name: CreateMetadataField :one
INSERT INTO global_attribute_metadata_fields (
  id, global_attribute_id, field_name, display_name, field_type,
  is_required, default_value, select_options, help_text, position
) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
RETURNING id, global_attribute_id, field_name, display_name, field_type, is_required, default_value, select_options, help_text, position, created_at
`

type CreateMetadataFieldParams struct {
	ID                uuid.UUID `json:"id"`
	GlobalAttributeID uuid.UUID `json:"global_attribute_id"`
	FieldName         string    `json:"field_name"`
	DisplayName       string    `json:"display_name"`
	FieldType         string    `json:"field_type"`
	IsRequired        bool      `json:"is_required"`
	DefaultValue      *string   `json:"default_value"`
	SelectOptions     []string  `json:"select_options"`
	HelpText          *string   `json:"help_text"`
	Position          int32     `json:"position"`
}

func (q *Queries) CreateMetadataField(ctx context.Context, arg CreateMetadataFieldParams) (GlobalAttributeMetadataField, error) {
	row := q.db.QueryRow(ctx, createMetadataField,
		arg.ID,
		arg.GlobalAttributeID,
		arg.FieldName,
		arg.DisplayName,
		arg.FieldType,
		arg.IsRequired,
		arg.DefaultValue,
		arg.SelectOptions,
		arg.HelpText,
		arg.Position,
	)
	var i GlobalAttributeMetadataField
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.FieldName,
		&i.DisplayName,
		&i.FieldType,
		&i.IsRequired,
		&i.DefaultValue,
		&i.SelectOptions,
		&i.HelpText,
		&i.Position,
		&i.CreatedAt,
	)
	return i, err
}

const createOptionSelection = `-- name: CreateOptionSelection :one
INSERT INTO product_global_option_selections (
  id, link_id, global_option_id, price_modifier,
  weight_modifier_grams, position_override
) VALUES ($1, $2, $3, $4, $5, $6)
RETURNING id, link_id, global_option_id, price_modifier, weight_modifier_grams, position_override
`

type CreateOptionSelectionParams struct {
	ID                  uuid.UUID      `json:"id"`
	LinkID              uuid.UUID      `json:"link_id"`
	GlobalOptionID      uuid.UUID      `json:"global_option_id"`
	PriceModifier       pgtype.Numeric `json:"price_modifier"`
	WeightModifierGrams *int32         `json:"weight_modifier_grams"`
	PositionOverride    *int32         `json:"position_override"`
}

func (q *Queries) CreateOptionSelection(ctx context.Context, arg CreateOptionSelectionParams) (ProductGlobalOptionSelection, error) {
	row := q.db.QueryRow(ctx, createOptionSelection,
		arg.ID,
		arg.LinkID,
		arg.GlobalOptionID,
		arg.PriceModifier,
		arg.WeightModifierGrams,
		arg.PositionOverride,
	)
	var i ProductGlobalOptionSelection
	err := row.Scan(
		&i.ID,
		&i.LinkID,
		&i.GlobalOptionID,
		&i.PriceModifier,
		&i.WeightModifierGrams,
		&i.PositionOverride,
	)
	return i, err
}

const createProductGlobalAttributeLink = `-- name: CreateProductGlobalAttributeLink :one
INSERT INTO product_global_attribute_links (
  id, product_id, global_attribute_id, role_name, role_display_name,
  position, affects_pricing, affects_shipping,
  price_modifier_field, weight_modifier_field
) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
RETURNING id, product_id, global_attribute_id, role_name, role_display_name, position, affects_pricing, affects_shipping, price_modifier_field, weight_modifier_field, created_at
`

type CreateProductGlobalAttributeLinkParams struct {
	ID                  uuid.UUID `json:"id"`
	ProductID           uuid.UUID `json:"product_id"`
	GlobalAttributeID   uuid.UUID `json:"global_attribute_id"`
	RoleName            string    `json:"role_name"`
	RoleDisplayName     string    `json:"role_display_name"`
	Position            int32     `json:"position"`
	AffectsPricing      bool      `json:"affects_pricing"`
	AffectsShipping     bool      `json:"affects_shipping"`
	PriceModifierField  *string   `json:"price_modifier_field"`
	WeightModifierField *string   `json:"weight_modifier_field"`
}

func (q *Queries) CreateProductGlobalAttributeLink(ctx context.Context, arg CreateProductGlobalAttributeLinkParams) (ProductGlobalAttributeLink, error) {
	row := q.db.QueryRow(ctx, createProductGlobalAttributeLink,
		arg.ID,
		arg.ProductID,
		arg.GlobalAttributeID,
		arg.RoleName,
		arg.RoleDisplayName,
		arg.Position,
		arg.AffectsPricing,
		arg.AffectsShipping,
		arg.PriceModifierField,
		arg.WeightModifierField,
	)
	var i ProductGlobalAttributeLink
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.GlobalAttributeID,
		&i.RoleName,
		&i.RoleDisplayName,
		&i.Position,
		&i.AffectsPricing,
		&i.AffectsShipping,
		&i.PriceModifierField,
		&i.WeightModifierField,
		&i.CreatedAt,
	)
	return i, err
}

const deleteAllOptionSelections = `-- name: DeleteAllOptionSelections :exec
DELETE FROM product_global_option_selections WHERE link_id = $1
`

func (q *Queries) DeleteAllOptionSelections(ctx context.Context, linkID uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteAllOptionSelections, linkID)
	return err
}

const deleteGlobalAttribute = `-- name: DeleteGlobalAttribute :exec
DELETE FROM global_attributes WHERE id = $1
`

func (q *Queries) DeleteGlobalAttribute(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteGlobalAttribute, id)
	return err
}

const deleteGlobalAttributeOption = `-- name: DeleteGlobalAttributeOption :exec
DELETE FROM global_attribute_options WHERE id = $1
`

func (q *Queries) DeleteGlobalAttributeOption(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteGlobalAttributeOption, id)
	return err
}

const deleteMetadataField = `-- name: DeleteMetadataField :exec
DELETE FROM global_attribute_metadata_fields WHERE id = $1
`

func (q *Queries) DeleteMetadataField(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteMetadataField, id)
	return err
}

const deleteOptionSelection = `-- name: DeleteOptionSelection :exec
DELETE FROM product_global_option_selections WHERE id = $1
`

func (q *Queries) DeleteOptionSelection(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteOptionSelection, id)
	return err
}

const deleteProductGlobalAttributeLink = `-- name: DeleteProductGlobalAttributeLink :exec
DELETE FROM product_global_attribute_links WHERE id = $1
`

func (q *Queries) DeleteProductGlobalAttributeLink(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteProductGlobalAttributeLink, id)
	return err
}

const deleteVariantGlobalOptions = `-- name: DeleteVariantGlobalOptions :exec
DELETE FROM product_variant_global_options WHERE variant_id = $1
`

func (q *Queries) DeleteVariantGlobalOptions(ctx context.Context, variantID uuid.UUID) error {
	_, err := q.db.Exec(ctx, deleteVariantGlobalOptions, variantID)
	return err
}

const getGlobalAttribute = `-- name: GetGlobalAttribute :one
SELECT id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at FROM global_attributes WHERE id = $1
`

func (q *Queries) GetGlobalAttribute(ctx context.Context, id uuid.UUID) (GlobalAttribute, error) {
	row := q.db.QueryRow(ctx, getGlobalAttribute, id)
	var i GlobalAttribute
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DisplayName,
		&i.Description,
		&i.AttributeType,
		&i.Category,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getGlobalAttributeByName = `-- name: GetGlobalAttributeByName :one
SELECT id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at FROM global_attributes WHERE name = $1
`

func (q *Queries) GetGlobalAttributeByName(ctx context.Context, name string) (GlobalAttribute, error) {
	row := q.db.QueryRow(ctx, getGlobalAttributeByName, name)
	var i GlobalAttribute
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DisplayName,
		&i.Description,
		&i.AttributeType,
		&i.Category,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getGlobalAttributeOption = `-- name: GetGlobalAttributeOption :one
SELECT id, global_attribute_id, value, display_value, color_hex, image_url, metadata, position, is_active, created_at, updated_at FROM global_attribute_options WHERE id = $1
`

func (q *Queries) GetGlobalAttributeOption(ctx context.Context, id uuid.UUID) (GlobalAttributeOption, error) {
	row := q.db.QueryRow(ctx, getGlobalAttributeOption, id)
	var i GlobalAttributeOption
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.Value,
		&i.DisplayValue,
		&i.ColorHex,
		&i.ImageUrl,
		&i.Metadata,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getMetadataField = `-- name: GetMetadataField :one
SELECT id, global_attribute_id, field_name, display_name, field_type, is_required, default_value, select_options, help_text, position, created_at FROM global_attribute_metadata_fields WHERE id = $1
`

func (q *Queries) GetMetadataField(ctx context.Context, id uuid.UUID) (GlobalAttributeMetadataField, error) {
	row := q.db.QueryRow(ctx, getMetadataField, id)
	var i GlobalAttributeMetadataField
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.FieldName,
		&i.DisplayName,
		&i.FieldType,
		&i.IsRequired,
		&i.DefaultValue,
		&i.SelectOptions,
		&i.HelpText,
		&i.Position,
		&i.CreatedAt,
	)
	return i, err
}

const getProductGlobalAttributeLink = `-- name: GetProductGlobalAttributeLink :one
SELECT id, product_id, global_attribute_id, role_name, role_display_name, position, affects_pricing, affects_shipping, price_modifier_field, weight_modifier_field, created_at FROM product_global_attribute_links WHERE id = $1
`

func (q *Queries) GetProductGlobalAttributeLink(ctx context.Context, id uuid.UUID) (ProductGlobalAttributeLink, error) {
	row := q.db.QueryRow(ctx, getProductGlobalAttributeLink, id)
	var i ProductGlobalAttributeLink
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.GlobalAttributeID,
		&i.RoleName,
		&i.RoleDisplayName,
		&i.Position,
		&i.AffectsPricing,
		&i.AffectsShipping,
		&i.PriceModifierField,
		&i.WeightModifierField,
		&i.CreatedAt,
	)
	return i, err
}

const listGlobalAttributeOptions = `-- name: ListGlobalAttributeOptions :many

SELECT id, global_attribute_id, value, display_value, color_hex, image_url, metadata, position, is_active, created_at, updated_at FROM global_attribute_options
WHERE global_attribute_id = $1
ORDER BY position
`

// ============================================================
// Global Attribute Options
// ============================================================
func (q *Queries) ListGlobalAttributeOptions(ctx context.Context, globalAttributeID uuid.UUID) ([]GlobalAttributeOption, error) {
	rows, err := q.db.Query(ctx, listGlobalAttributeOptions, globalAttributeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GlobalAttributeOption{}
	for rows.Next() {
		var i GlobalAttributeOption
		if err := rows.Scan(
			&i.ID,
			&i.GlobalAttributeID,
			&i.Value,
			&i.DisplayValue,
			&i.ColorHex,
			&i.ImageUrl,
			&i.Metadata,
			&i.Position,
			&i.IsActive,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listGlobalAttributes = `-- name: ListGlobalAttributes :many

SELECT id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at FROM global_attributes ORDER BY position, name
`

// ============================================================
// Global Attributes
// ============================================================
func (q *Queries) ListGlobalAttributes(ctx context.Context) ([]GlobalAttribute, error) {
	rows, err := q.db.Query(ctx, listGlobalAttributes)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GlobalAttribute{}
	for rows.Next() {
		var i GlobalAttribute
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.DisplayName,
			&i.Description,
			&i.AttributeType,
			&i.Category,
			&i.Position,
			&i.IsActive,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listGlobalAttributesByCategory = `-- name: ListGlobalAttributesByCategory :many
SELECT id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at FROM global_attributes WHERE category = $1 ORDER BY position, name
`

func (q *Queries) ListGlobalAttributesByCategory(ctx context.Context, category *string) ([]GlobalAttribute, error) {
	rows, err := q.db.Query(ctx, listGlobalAttributesByCategory, category)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GlobalAttribute{}
	for rows.Next() {
		var i GlobalAttribute
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.DisplayName,
			&i.Description,
			&i.AttributeType,
			&i.Category,
			&i.Position,
			&i.IsActive,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listMetadataFields = `-- name: ListMetadataFields :many

SELECT id, global_attribute_id, field_name, display_name, field_type, is_required, default_value, select_options, help_text, position, created_at FROM global_attribute_metadata_fields
WHERE global_attribute_id = $1
ORDER BY position, field_name
`

// ============================================================
// Global Attribute Metadata Fields
// ============================================================
func (q *Queries) ListMetadataFields(ctx context.Context, globalAttributeID uuid.UUID) ([]GlobalAttributeMetadataField, error) {
	rows, err := q.db.Query(ctx, listMetadataFields, globalAttributeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GlobalAttributeMetadataField{}
	for rows.Next() {
		var i GlobalAttributeMetadataField
		if err := rows.Scan(
			&i.ID,
			&i.GlobalAttributeID,
			&i.FieldName,
			&i.DisplayName,
			&i.FieldType,
			&i.IsRequired,
			&i.DefaultValue,
			&i.SelectOptions,
			&i.HelpText,
			&i.Position,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listOptionSelections = `-- name: ListOptionSelections :many

SELECT id, link_id, global_option_id, price_modifier, weight_modifier_grams, position_override FROM product_global_option_selections
WHERE link_id = $1
ORDER BY position_override NULLS LAST
`

// ============================================================
// Product Global Option Selections
// ============================================================
func (q *Queries) ListOptionSelections(ctx context.Context, linkID uuid.UUID) ([]ProductGlobalOptionSelection, error) {
	rows, err := q.db.Query(ctx, listOptionSelections, linkID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ProductGlobalOptionSelection{}
	for rows.Next() {
		var i ProductGlobalOptionSelection
		if err := rows.Scan(
			&i.ID,
			&i.LinkID,
			&i.GlobalOptionID,
			&i.PriceModifier,
			&i.WeightModifierGrams,
			&i.PositionOverride,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listProductGlobalAttributeLinks = `-- name: ListProductGlobalAttributeLinks :many

SELECT id, product_id, global_attribute_id, role_name, role_display_name, position, affects_pricing, affects_shipping, price_modifier_field, weight_modifier_field, created_at FROM product_global_attribute_links
WHERE product_id = $1
ORDER BY position
`

// ============================================================
// Product Global Attribute Links
// ============================================================
func (q *Queries) ListProductGlobalAttributeLinks(ctx context.Context, productID uuid.UUID) ([]ProductGlobalAttributeLink, error) {
	rows, err := q.db.Query(ctx, listProductGlobalAttributeLinks, productID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ProductGlobalAttributeLink{}
	for rows.Next() {
		var i ProductGlobalAttributeLink
		if err := rows.Scan(
			&i.ID,
			&i.ProductID,
			&i.GlobalAttributeID,
			&i.RoleName,
			&i.RoleDisplayName,
			&i.Position,
			&i.AffectsPricing,
			&i.AffectsShipping,
			&i.PriceModifierField,
			&i.WeightModifierField,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listProductsUsingGlobalAttribute = `-- name: ListProductsUsingGlobalAttribute :many
SELECT DISTINCT p.id, p.name, p.slug, p.status
FROM products p
JOIN product_global_attribute_links pgal ON pgal.product_id = p.id
WHERE pgal.global_attribute_id = $1
ORDER BY p.name
`

type ListProductsUsingGlobalAttributeRow struct {
	ID     uuid.UUID `json:"id"`
	Name   string    `json:"name"`
	Slug   string    `json:"slug"`
	Status string    `json:"status"`
}

func (q *Queries) ListProductsUsingGlobalAttribute(ctx context.Context, globalAttributeID uuid.UUID) ([]ListProductsUsingGlobalAttributeRow, error) {
	rows, err := q.db.Query(ctx, listProductsUsingGlobalAttribute, globalAttributeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListProductsUsingGlobalAttributeRow{}
	for rows.Next() {
		var i ListProductsUsingGlobalAttributeRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Slug,
			&i.Status,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listVariantGlobalOptions = `-- name: ListVariantGlobalOptions :many

SELECT pvgo.variant_id, pvgo.link_id, pvgo.global_option_id,
       ga.name AS attribute_name, ga.display_name AS attribute_display_name,
       gao.value AS option_value, gao.display_value AS option_display_value,
       pgal.role_name, pgal.role_display_name
FROM product_variant_global_options pvgo
JOIN product_global_attribute_links pgal ON pgal.id = pvgo.link_id
JOIN global_attributes ga ON ga.id = pgal.global_attribute_id
JOIN global_attribute_options gao ON gao.id = pvgo.global_option_id
WHERE pvgo.variant_id = $1
ORDER BY pgal.position
`

type ListVariantGlobalOptionsRow struct {
	VariantID            uuid.UUID `json:"variant_id"`
	LinkID               uuid.UUID `json:"link_id"`
	GlobalOptionID       uuid.UUID `json:"global_option_id"`
	AttributeName        string    `json:"attribute_name"`
	AttributeDisplayName string    `json:"attribute_display_name"`
	OptionValue          string    `json:"option_value"`
	OptionDisplayValue   string    `json:"option_display_value"`
	RoleName             string    `json:"role_name"`
	RoleDisplayName      string    `json:"role_display_name"`
}

// ============================================================
// Variant Global Options
// ============================================================
func (q *Queries) ListVariantGlobalOptions(ctx context.Context, variantID uuid.UUID) ([]ListVariantGlobalOptionsRow, error) {
	rows, err := q.db.Query(ctx, listVariantGlobalOptions, variantID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListVariantGlobalOptionsRow{}
	for rows.Next() {
		var i ListVariantGlobalOptionsRow
		if err := rows.Scan(
			&i.VariantID,
			&i.LinkID,
			&i.GlobalOptionID,
			&i.AttributeName,
			&i.AttributeDisplayName,
			&i.OptionValue,
			&i.OptionDisplayValue,
			&i.RoleName,
			&i.RoleDisplayName,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const setVariantGlobalOption = `-- name: SetVariantGlobalOption :exec
INSERT INTO product_variant_global_options (variant_id, link_id, global_option_id)
VALUES ($1, $2, $3)
ON CONFLICT (variant_id, link_id) DO UPDATE SET global_option_id = EXCLUDED.global_option_id
`

type SetVariantGlobalOptionParams struct {
	VariantID      uuid.UUID `json:"variant_id"`
	LinkID         uuid.UUID `json:"link_id"`
	GlobalOptionID uuid.UUID `json:"global_option_id"`
}

func (q *Queries) SetVariantGlobalOption(ctx context.Context, arg SetVariantGlobalOptionParams) error {
	_, err := q.db.Exec(ctx, setVariantGlobalOption, arg.VariantID, arg.LinkID, arg.GlobalOptionID)
	return err
}

const updateGlobalAttribute = `-- name: UpdateGlobalAttribute :one
UPDATE global_attributes SET
  name = $2, display_name = $3, description = $4,
  attribute_type = $5, category = $6, position = $7,
  is_active = $8, updated_at = now()
WHERE id = $1
RETURNING id, name, display_name, description, attribute_type, category, position, is_active, created_at, updated_at
`

type UpdateGlobalAttributeParams struct {
	ID            uuid.UUID `json:"id"`
	Name          string    `json:"name"`
	DisplayName   string    `json:"display_name"`
	Description   *string   `json:"description"`
	AttributeType string    `json:"attribute_type"`
	Category      *string   `json:"category"`
	Position      int32     `json:"position"`
	IsActive      bool      `json:"is_active"`
}

func (q *Queries) UpdateGlobalAttribute(ctx context.Context, arg UpdateGlobalAttributeParams) (GlobalAttribute, error) {
	row := q.db.QueryRow(ctx, updateGlobalAttribute,
		arg.ID,
		arg.Name,
		arg.DisplayName,
		arg.Description,
		arg.AttributeType,
		arg.Category,
		arg.Position,
		arg.IsActive,
	)
	var i GlobalAttribute
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.DisplayName,
		&i.Description,
		&i.AttributeType,
		&i.Category,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateGlobalAttributeOption = `-- name: UpdateGlobalAttributeOption :one
UPDATE global_attribute_options SET
  value = $2, display_value = $3, color_hex = $4, image_url = $5,
  metadata = $6, position = $7, is_active = $8, updated_at = now()
WHERE id = $1
RETURNING id, global_attribute_id, value, display_value, color_hex, image_url, metadata, position, is_active, created_at, updated_at
`

type UpdateGlobalAttributeOptionParams struct {
	ID           uuid.UUID       `json:"id"`
	Value        string          `json:"value"`
	DisplayValue string          `json:"display_value"`
	ColorHex     *string         `json:"color_hex"`
	ImageUrl     *string         `json:"image_url"`
	Metadata     json.RawMessage `json:"metadata"`
	Position     int32           `json:"position"`
	IsActive     bool            `json:"is_active"`
}

func (q *Queries) UpdateGlobalAttributeOption(ctx context.Context, arg UpdateGlobalAttributeOptionParams) (GlobalAttributeOption, error) {
	row := q.db.QueryRow(ctx, updateGlobalAttributeOption,
		arg.ID,
		arg.Value,
		arg.DisplayValue,
		arg.ColorHex,
		arg.ImageUrl,
		arg.Metadata,
		arg.Position,
		arg.IsActive,
	)
	var i GlobalAttributeOption
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.Value,
		&i.DisplayValue,
		&i.ColorHex,
		&i.ImageUrl,
		&i.Metadata,
		&i.Position,
		&i.IsActive,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateMetadataField = `-- name: UpdateMetadataField :one
UPDATE global_attribute_metadata_fields SET
  field_name = $2, display_name = $3, field_type = $4,
  is_required = $5, default_value = $6, select_options = $7,
  help_text = $8, position = $9
WHERE id = $1
RETURNING id, global_attribute_id, field_name, display_name, field_type, is_required, default_value, select_options, help_text, position, created_at
`

type UpdateMetadataFieldParams struct {
	ID            uuid.UUID `json:"id"`
	FieldName     string    `json:"field_name"`
	DisplayName   string    `json:"display_name"`
	FieldType     string    `json:"field_type"`
	IsRequired    bool      `json:"is_required"`
	DefaultValue  *string   `json:"default_value"`
	SelectOptions []string  `json:"select_options"`
	HelpText      *string   `json:"help_text"`
	Position      int32     `json:"position"`
}

func (q *Queries) UpdateMetadataField(ctx context.Context, arg UpdateMetadataFieldParams) (GlobalAttributeMetadataField, error) {
	row := q.db.QueryRow(ctx, updateMetadataField,
		arg.ID,
		arg.FieldName,
		arg.DisplayName,
		arg.FieldType,
		arg.IsRequired,
		arg.DefaultValue,
		arg.SelectOptions,
		arg.HelpText,
		arg.Position,
	)
	var i GlobalAttributeMetadataField
	err := row.Scan(
		&i.ID,
		&i.GlobalAttributeID,
		&i.FieldName,
		&i.DisplayName,
		&i.FieldType,
		&i.IsRequired,
		&i.DefaultValue,
		&i.SelectOptions,
		&i.HelpText,
		&i.Position,
		&i.CreatedAt,
	)
	return i, err
}

const updateProductGlobalAttributeLink = `-- name: UpdateProductGlobalAttributeLink :one
UPDATE product_global_attribute_links SET
  role_name = $2, role_display_name = $3, position = $4,
  affects_pricing = $5, affects_shipping = $6,
  price_modifier_field = $7, weight_modifier_field = $8
WHERE id = $1
RETURNING id, product_id, global_attribute_id, role_name, role_display_name, position, affects_pricing, affects_shipping, price_modifier_field, weight_modifier_field, created_at
`

type UpdateProductGlobalAttributeLinkParams struct {
	ID                  uuid.UUID `json:"id"`
	RoleName            string    `json:"role_name"`
	RoleDisplayName     string    `json:"role_display_name"`
	Position            int32     `json:"position"`
	AffectsPricing      bool      `json:"affects_pricing"`
	AffectsShipping     bool      `json:"affects_shipping"`
	PriceModifierField  *string   `json:"price_modifier_field"`
	WeightModifierField *string   `json:"weight_modifier_field"`
}

func (q *Queries) UpdateProductGlobalAttributeLink(ctx context.Context, arg UpdateProductGlobalAttributeLinkParams) (ProductGlobalAttributeLink, error) {
	row := q.db.QueryRow(ctx, updateProductGlobalAttributeLink,
		arg.ID,
		arg.RoleName,
		arg.RoleDisplayName,
		arg.Position,
		arg.AffectsPricing,
		arg.AffectsShipping,
		arg.PriceModifierField,
		arg.WeightModifierField,
	)
	var i ProductGlobalAttributeLink
	err := row.Scan(
		&i.ID,
		&i.ProductID,
		&i.GlobalAttributeID,
		&i.RoleName,
		&i.RoleDisplayName,
		&i.Position,
		&i.AffectsPricing,
		&i.AffectsShipping,
		&i.PriceModifierField,
		&i.WeightModifierField,
		&i.CreatedAt,
	)
	return i, err
}
